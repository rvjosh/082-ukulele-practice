<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ðŸŽ¼</text></svg>">
  <title>Note Practice</title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
    const { useState, useRef, useMemo, useEffect } = React;

    function NotePractice() {
      const audioContextRef = useRef(null);

      // All notes from C2 to B6 (5 octaves)
      const allNotes = [
        'C2', 'D2', 'E2', 'F2', 'G2', 'A2', 'B2',
        'C3', 'D3', 'E3', 'F3', 'G3', 'A3', 'B3',
        'C4', 'D4', 'E4', 'F4', 'G4', 'A4', 'B4',
        'C5', 'D5', 'E5', 'F5', 'G5', 'A5', 'B5',
        'C6', 'D6', 'E6', 'F6', 'G6', 'A6', 'B6',
        'C7'
      ];

      // Frequencies for all notes C2-B6
      const noteFrequencies = {
        'C2': 65.41, 'D2': 73.42, 'E2': 82.41, 'F2': 87.31, 'G2': 98.00, 'A2': 110.00, 'B2': 123.47,
        'C3': 130.81, 'D3': 146.83, 'E3': 164.81, 'F3': 174.61, 'G3': 196.00, 'A3': 220.00, 'B3': 246.94,
        'C4': 261.63, 'D4': 293.66, 'E4': 329.63, 'F4': 349.23, 'G4': 392.00, 'A4': 440.00, 'B4': 493.88,
        'C5': 523.25, 'D5': 587.33, 'E5': 659.25, 'F5': 698.46, 'G5': 783.99, 'A5': 880.00, 'B5': 987.77,
        'C6': 1046.50, 'D6': 1174.66, 'E6': 1318.51, 'F6': 1396.91, 'G6': 1567.98, 'A6': 1760.00, 'B6': 1975.53,
        'C7': 2093.00
      };

      const [rangeStart, setRangeStart] = useState(14); // C4
      const [rangeEnd, setRangeEnd] = useState(20); // B4
      const [currentNote, setCurrentNote] = useState(allNotes[14]); // C4
      const [isTimerRunning, setIsTimerRunning] = useState(false);
      const [elapsedSeconds, setElapsedSeconds] = useState(0);

      const availableNotes = useMemo(() => {
        return allNotes.slice(rangeStart, rangeEnd + 1);
      }, [rangeStart, rangeEnd]);

      // Timer effect
      useEffect(() => {
        let interval;
        if (isTimerRunning) {
          interval = setInterval(() => {
            setElapsedSeconds(prev => prev + 1);
          }, 1000);
        }
        return () => clearInterval(interval);
      }, [isTimerRunning]);

      const formatTime = (totalSeconds) => {
        const minutes = Math.floor(totalSeconds / 60);
        const seconds = totalSeconds % 60;
        return `${minutes}:${seconds.toString().padStart(2, '0')}`;
      };

      const handleStart = () => {
        setIsTimerRunning(true);
      };

      const handleStop = () => {
        setIsTimerRunning(false);
        setElapsedSeconds(0);
      };

      const getAudioContext = () => {
        if (!audioContextRef.current) {
          audioContextRef.current = new (window.AudioContext || window.webkitAudioContext)();
        }
        return audioContextRef.current;
      };

      const playNote = () => {
        const audioContext = getAudioContext();
        const oscillator = audioContext.createOscillator();
        const gainNode = audioContext.createGain();

        oscillator.connect(gainNode);
        gainNode.connect(audioContext.destination);

        oscillator.type = 'sine';
        oscillator.frequency.value = noteFrequencies[currentNote];

        // Longer envelope for sustained sound
        gainNode.gain.setValueAtTime(0, audioContext.currentTime);
        gainNode.gain.linearRampToValueAtTime(0.5, audioContext.currentTime + 0.01);
        gainNode.gain.linearRampToValueAtTime(0.4, audioContext.currentTime + 1.5);
        gainNode.gain.linearRampToValueAtTime(0, audioContext.currentTime + 2.0);

        oscillator.start(audioContext.currentTime);
        oscillator.stop(audioContext.currentTime + 2.0);
      };

      const nextNote = () => {
        const otherNotes = availableNotes.filter(n => n !== currentNote);
        if (otherNotes.length === 0) {
          // If only one note in range, keep it
          return;
        }
        const randomNote = otherNotes[Math.floor(Math.random() * otherNotes.length)];
        setCurrentNote(randomNote);
      };

      const handleRangeStartChange = (e) => {
        const newStart = parseInt(e.target.value);
        if (newStart > rangeEnd) return;
        setRangeStart(newStart);
        // Ensure current note is within new range
        if (allNotes.indexOf(currentNote) < newStart || allNotes.indexOf(currentNote) > rangeEnd) {
          setCurrentNote(allNotes[newStart]);
        }
      };

      const handleRangeEndChange = (e) => {
        const newEnd = parseInt(e.target.value);
        if (newEnd < rangeStart) return;
        setRangeEnd(newEnd);
        // Ensure current note is within new range
        if (allNotes.indexOf(currentNote) < rangeStart || allNotes.indexOf(currentNote) > newEnd) {
          setCurrentNote(allNotes[newEnd]);
        }
      };

      return (
        <div className="min-h-screen bg-gradient-to-br from-amber-50 to-orange-100 p-8">
          <div className="max-w-2xl mx-auto">
            <a href="index.html" className="text-amber-600 hover:text-amber-800 mb-4 inline-block">&larr; Back</a>
            <h1 className="text-3xl font-bold text-amber-900 text-center mb-8">
              Note Practice
            </h1>

            <div className="bg-white rounded-xl shadow-lg p-8 text-center mb-6">
              {/* Note Display */}
              <div className="text-9xl font-bold text-amber-600 mb-8">
                {currentNote}
              </div>

              {/* Play Button */}
              <button
                onClick={playNote}
                className="w-full bg-amber-500 hover:bg-amber-600 text-white font-bold py-4 px-8 rounded-lg text-xl mb-4 transition-colors"
              >
                Play Note
              </button>

              {/* Next Button */}
              <button
                onClick={nextNote}
                className="w-full bg-amber-100 hover:bg-amber-200 text-amber-800 font-bold py-4 px-8 rounded-lg text-xl transition-colors"
              >
                Next Note
              </button>
            </div>

            {/* Range Selection */}
            <div className="bg-white rounded-xl shadow-lg p-6">
              <h2 className="text-lg font-semibold text-amber-900 mb-4">Note Range</h2>

              <div className="mb-4">
                <label className="block text-sm text-amber-700 mb-2">
                  From: <span className="font-bold">{allNotes[rangeStart]}</span>
                </label>
                <input
                  type="range"
                  min="0"
                  max="35"
                  value={rangeStart}
                  onChange={handleRangeStartChange}
                  className="w-full h-3 bg-amber-200 rounded-lg appearance-none cursor-pointer"
                />
              </div>

              <div className="mb-4">
                <label className="block text-sm text-amber-700 mb-2">
                  To: <span className="font-bold">{allNotes[rangeEnd]}</span>
                </label>
                <input
                  type="range"
                  min="0"
                  max="35"
                  value={rangeEnd}
                  onChange={handleRangeEndChange}
                  className="w-full h-3 bg-amber-200 rounded-lg appearance-none cursor-pointer"
                />
              </div>

              <p className="text-amber-600 text-sm text-center">
                {availableNotes.length} note{availableNotes.length !== 1 ? 's' : ''}: {allNotes[rangeStart]} - {allNotes[rangeEnd]}
              </p>
            </div>

            {/* Timer */}
            <div className="bg-white rounded-xl shadow-lg p-6 mt-6">
              <div className="text-4xl font-mono font-bold text-amber-900 text-center mb-4">
                {formatTime(elapsedSeconds)}
              </div>
              <div className="flex gap-4">
                <button
                  onClick={handleStart}
                  disabled={isTimerRunning}
                  className="flex-1 bg-green-500 hover:bg-green-600 disabled:bg-green-300 text-white font-bold py-3 px-6 rounded-lg text-lg transition-colors"
                >
                  Start
                </button>
                <button
                  onClick={handleStop}
                  disabled={!isTimerRunning && elapsedSeconds === 0}
                  className="flex-1 bg-red-500 hover:bg-red-600 disabled:bg-red-300 text-white font-bold py-3 px-6 rounded-lg text-lg transition-colors"
                >
                  Stop
                </button>
              </div>
            </div>
          </div>
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<NotePractice />);
  </script>
</body>
</html>
